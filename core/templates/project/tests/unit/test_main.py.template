"""
Unit tests for the main application.

This module tests the main FastAPI application setup,
middleware, and basic functionality.
"""

import pytest
from fastapi.testclient import TestClient

from src.main import app


class TestMainApp:
    """Test cases for the main FastAPI application."""

    def test_app_initialization(self):
        """Test that the app initializes correctly."""
        assert app is not None
        assert app.title == "{{ project_name }}"
        assert app.version == "0.1.0"

    def test_root_endpoint(self, client: TestClient):
        """Test the root endpoint."""
        response = client.get("/")
        assert response.status_code == 200

        data = response.json()
        assert "message" in data
        assert "version" in data
        assert "{{ project_name }}" in data["message"]

    def test_health_endpoint(self, client: TestClient):
        """Test the health check endpoint."""
        response = client.get("/health")
        assert response.status_code == 200

        data = response.json()
        assert data["status"] == "healthy"
        assert "timestamp" in data
        assert "version" in data
        assert "environment" in data

    def test_cors_headers(self, client: TestClient):
        """Test that CORS headers are set correctly."""
        response = client.options("/")
        assert "access-control-allow-origin" in response.headers

    def test_process_time_header(self, client: TestClient):
        """Test that process time header is added."""
        response = client.get("/")
        assert "x-process-time" in response.headers
        assert float(response.headers["x-process-time"]) >= 0

    def test_docs_available_in_debug(self, client: TestClient):
        """Test that docs are available in debug mode."""
        response = client.get("/docs")
        assert response.status_code == 200

    def test_api_docs_available(self, client: TestClient):
        """Test that API docs are available."""
        response = client.get("/api/v1/health/")
        assert response.status_code == 200
